# slurm.conf file generated by configurator.html.
# Put this file on all nodes of your cluster.
# See the slurm.conf man page for more information.
#
ControlMachine=smp-head0.crc.pitt.edu
ControlAddr=10.201.0.93
#BARRY: Consider adding head1.sam.pitt.edu below
#BackupController=localhost
#BackupAddr=10.201.0.92
# 
AuthType=auth/munge
#CheckpointType=checkpoint/none 
CryptoType=crypto/munge
#DisableRootJobs=NO 
#EnforcePartLimits=NO 
#BARRY: For MPI, /opt/sam/sys/etc/slurm/slurm-epilog
Epilog=/ihome/sam/cluster/slurm/slurm-epilog
#EpilogSlurmctld= 
#FirstJobId=1 
#MaxJobId=999999 
#GresTypes= 
#GroupUpdateForce=0 
#GroupUpdateTime=600 
#JobCheckpointDir=/var/slurm/checkpoint 
#JobCredentialPrivateKey=
#JobCredentialPublicCertificate=
#JobFileAppend=0 
#JobRequeue=1 
JobSubmitPlugins="lua"
#KillOnBadExit=0 
#LaunchType=launch/slurm 
Licenses=stata:17
#MailProg=/bin/mail 
#MaxJobCount=5000 
#MaxStepCount=40000 
#MaxTasksPerNode=128 
#BARRY: Documentation -> http://slurm.schedmd.com/mpi_guide.html#intel_srun
MpiDefault=none
#MpiParams=ports=#-# 
#PluginDir= 
#PlugStackConfig= 
#PrivateData=jobs 
ProctrackType=proctrack/pgid
#BARRY: On MPI, /opt/sam/sys/etc/slurm/slurm-prolog
Prolog=/ihome/sam/cluster/slurm/slurm-prolog
TaskProlog=/ihome/sam/cluster/slurm/slurm-taskprolog
PrologFlags=Alloc,X11
#PrologSlurmctld= 
#PropagatePrioProcess=0 
#PropagateResourceLimits= 
#PropagateResourceLimitsExcept= 
RebootProgram="/usr/sbin/reboot"
ReturnToService=1
#SallocDefaultCommand= 
SlurmctldPidFile=/var/run/slurmctld.pid
SlurmctldPort=6817
SlurmdPidFile=/var/run/slurmd.pid
SlurmdPort=6818
SlurmdSpoolDir=/var/spool/slurmd
SlurmUser=slurm
#SlurmdUser=root 
#SrunEpilog=
#SrunProlog=
#BARRY: On MPI, /var/slurmstate
StateSaveLocation=/var/slurmstate
SwitchType=switch/none
#TaskEpilog=
TaskPlugin=task/affinity
# The blow is no longer support in slurm > 20.02
#TaskPluginParam=Sched
#TaskProlog=
#TopologyPlugin=topology/tree 
#TmpFS=/scratch
#TrackWCKey=no 
#TreeWidth= 
#UnkillableStepProgram= 
#UsePAM=0 
# 
# 
# TIMERS 
#BatchStartTimeout=10 
#CompleteWait=0 
#EpilogMsgTime=2000 
#GetEnvTimeout=2
HealthCheckInterval=300
HealthCheckProgram=/usr/sbin/nhc
InactiveLimit=0
KillWait=30
MessageTimeout=20 
#ResvOverRun=0 
MinJobAge=300
#OverTimeLimit=0 
SlurmctldTimeout=120
SlurmdTimeout=300
UnkillableStepTimeout=120
#VSizeFactor=0 
Waittime=0
# 
# 
# SCHEDULING 
#DefMemPerCPU=0 
#MaxMemPerCPU=0 
#SchedulerRootFilter=1 
#SchedulerTimeSlice=30 
SchedulerType=sched/backfill
#SchedulerParameters=max_rpc_cnt=200
SchedulerParameters=defer
# The below is no longer supported in slurm > 20.02
# Has been replaced with SlurmctldPort
#SchedulerPort=7321
SelectType=select/cons_res
#BARRY: From Documentation, "Setting a value for DefMemPerCPU is strongly recommended."
SelectTypeParameters=CR_Core_Memory
# -> DefMemPerCPU in MB = RealMemory / CPUs (lowest on cluster, rounded down)
DefMemPerCPU=4018
# 
# 

#PreemptType 
#based upon QOS Jobs can be in the same or different partitions."preemption rules defined in the database using sacctmgr"
PreemptType=preempt/qos
PreemptMode=cancel

# JOB PRIORITY 
PriorityFlags=MAX_TRES
PriorityType=priority/multifactor
#BARRY: From Documentation, http://slurm.schedmd.com/sacctmgr.html
# -> Under "GENERAL SPECIFICATIONS FOR ASSOCIATION BASED ENTITIES", See GrpTRESMins "ALSO NOTE"
# -> As well as http://slurm.schedmd.com/slurm.conf.html, "PriorityDecayHalfLife"
PriorityDecayHalfLife=0-00:00:00
PriorityUsageResetPeriod=NONE

#PriorityCalcPeriod= 
#PriorityFavorSmall= 
#PriorityMaxAge= 
PriorityWeightAge=2000
PriorityWeightFairshare=3000
#KFW PriorityWeightJobSize=4000
PriorityWeightJobSize=2000
#PriorityWeightPartition= 
#KFW PriorityWeightQOS=50
PriorityWeightQOS=2000
PriorityWeightTRES=CPU=0,Mem=0
FairShareDampeningFactor=5

# LOGGING AND ACCOUNTING 
#BARRY: NOTES
# safe forces slurm to check for GrpTRESMins (SU emulation), if there is enough
# for the job it will start, otherwise denied. Need priority and billing weights 
AccountingStorageEnforce=safe,qos
AccountingStorageHost=db.crc.pitt.edu
#AccountingStorageLoc=10.201.0.124
#BARRY: probably need to set pass and port
#AccountingStoragePass=something
AccountingStoragePort=6819
#BARRY: Why slurmdbd over mysql?
AccountingStorageType=accounting_storage/slurmdbd
AccountingStorageUser=slurm
# Below is no longer supported in slurm > 20.02
# Replaced with AccountingStoreFlags
#AccountingStoreJobComment=YES
AccountingStoreFlags=job_comment
#BARRY: Change this!
ClusterName=smp
#BARRY: This line reduces a lot of garbage from logs
DebugFlags=NO_CONF_HASH
#JobCompHost=
#JobCompLoc=
#JobCompPass=
#JobCompPort=
#BARRY: Do we want this?
#JobCompType=jobcomp/slurmdbd
JobCompType=jobcomp/none
#JobCompUser=
#JobContainerType=job_container/none 
JobAcctGatherFrequency=30
#BARRY: On MPI, set to linux default is none.
JobAcctGatherType=jobacct_gather/linux
SlurmctldDebug=3
SlurmctldLogFile=/var/log/slurm/slurmctld.log
SlurmdDebug=3
SlurmdLogFile=/var/log/slurm/slurmd.log
#SlurmSchedLogFile= 
#SlurmSchedLogLevel= 
# 
# 
# POWER SAVE SUPPORT FOR IDLE NODES (optional) 
#SuspendProgram= 
#ResumeProgram= 
#SuspendTimeout= 
ResumeTimeout=840
#ResumeRate= 
#SuspendExcNodes= 
#SuspendExcParts= 
#SuspendRate= 
#SuspendTime= 
# TmpFS
TmpFS=/scratch 
# BARRY: Define the SrunPortRange
SrunPortRange=60001-63000
# BARRY: TRES and GRES Accounting
GresTypes=gpu,mic,nvme
# -> CPU, Energy, Memory, and Node specified by default
AccountingStorageTRES=gres/gpu,license/stata,gres/scratch

# COMPUTE NODES
# -> RealMemory in MB (free -m)
NodeName=smp-n[24-113,115-122,126-155] NodeHostname=smp-n[24-113,115-122,126-155] CPUs=24 RealMemory=192000 Sockets=2 CoresPerSocket=12 ThreadsPerCore=1 Weight=1 State=UNKNOWN Features=intel,skylake
#KFW moved 211 to pliu NodeName=smp-n[156-211] NodeHostname=smp-n[156-211] CPUs=32 RealMemory=257000 Sockets=2 CoresPerSocket=16 ThreadsPerCore=1 Weight=2 State=UNKNOWN Feature=amd
NodeName=smp-n[156-210] NodeHostname=smp-n[156-210] CPUs=32 RealMemory=257000 Sockets=2 CoresPerSocket=16 ThreadsPerCore=1 Weight=2 State=UNKNOWN Features=amd,rome
NodeName=smp-n[1-7,9-11,13-15,19-23] NodeHostname=smp-n[1-7,9-11,13-15,19-23] CPUs=12 RealMemory=257800 Sockets=2 CoresPerSocket=6 ThreadsPerCore=1 Weight=3 State=UNKNOWN Features=intel,broadwell
NodeName=smp-n[214-256] NodeHostname=smp-n[214-256] CPUs=64 RealMemory=773000 Sockets=2 CoresPerSocket=32 ThreadsPerCore=1 Weight=1 State=UNKNOWN Features=amd,genoa

NodeName=smp-256-n[1-2] NodeHostname=smp-256-n[1-2] CPUs=12 RealMemory=257800 Sockets=2 CoresPerSocket=6 ThreadsPerCore=1 State=UNKNOWN Weight=1 Features=raid,intel,broadwell
NodeName=smp-512-n[1-2] NodeHostname=smp-512-n[1-2] CPUs=12 RealMemory=515800 Sockets=2 CoresPerSocket=6 ThreadsPerCore=1 State=UNKNOWN Weight=2 Features=raid,intel,broadwell
NodeName=smp-nvme-n1 NodeHostname=smp-nvme-n1 CPUs=12 RealMemory=257800 Sockets=2 CoresPerSocket=6 ThreadsPerCore=1 State=UNKNOWN Weight=3 Features=nvme,intel,broadwell
NodeName=smp-1024-n0 NodeHostname=smp-1024-n0 CPUs=32 RealMemory=1019800 Sockets=2 CoresPerSocket=16 ThreadsPerCore=1 State=UNKNOWN Weight=4 Features=amd,naples
NodeName=smp-3072-n[0-3] NodeHostname=smp-3072-n[0-3] CPUs=80 RealMemory=3091000 Sockets=4 CoresPerSocket=20 ThreadsPerCore=1 State=UNKNOWN Weight=6 Features=bigram,intel,broadwell
NodeName=smp-1024-n[1-8] NodeHostname=smp-1024-n[1-8] CPUs=64 RealMemory=1031000 Sockets=2 CoresPerSocket=32 ThreadsPerCore=1 State=UNKNOWN Weight=4 Features=intel,ice_lake
NodeName=smp-2048-n[0-1] NodeHostname=smp-2048-n[0-1] CPUs=64 RealMemory=2063200 Sockets=2 CoresPerSocket=32 ThreadsPerCore=1 State=UNKNOWN Weight=5 Features=intel,ice_lake

# PARTITIONS
# -> TresBillingWeights
# CPU = <prefix> 
# Mem = <prefix> / (<real memory (mb)> / (<number of cores> * 1024))
#KFW moved 211 to pliu PartitionName=smp Nodes=smp-n[24-122,126-155],smp-n[0-16,19-23],smp-n[156-211] Default=YES AllowQos=short,normal,long,smp-smp-s,smp-smp-n,smp-smp-l,smp-smp-s-invest,smp-smp-n-invest,smp-smp-l-invest MaxNodes=1 State=UP TresBillingWeights="CPU=0.8,Mem=0.102G"
PartitionName=smp Nodes=smp-256-n[1,2],smp-512-n[1-2],smp-nvme-n1,smp-n[24-113,115-122,126-155],smp-n[1-7,9-11,13-15,19-23],smp-n[156-210],smp-n[214-256] Default=YES AllowQos=short,normal,long,smp-smp-s,smp-smp-n,smp-smp-l,smp-smp-s-invest,smp-smp-n-invest,smp-smp-l-invest MaxNodes=1 State=UP TresBillingWeights="CPU=0.8,Mem=0.102G"
PartitionName=high-mem Nodes=smp-1024-n[0-8],smp-2048-n[0-1],smp-3072-n[0-3] AllowQos=short,normal,long,smp-high-mem-s,smp-high-mem-n,smp-high-mem-l,smp-high-mem-s-invest,smp-high-mem-n-invest,smp-high-mem-l-invest State=UP TresBillingWeights="CPU=1.0,Mem=0.0477G"
PartitionName=scavenger Nodes=smp-n[24-113,115-122,126-155],smp-n[1-7,9-11,13-15,19-23],smp-n[156-210],smp-256-n[1,2],smp-512-n[1-2],smp-nvme-n1,smp-1024-n0,smp-3072-n[0-3] PreemptMode=cancel MaxNodes=1 AllowQos=short,normal,long,smp-scavenger-s,smp-scavenger-n,smp-scavenger-l State=Up TresBillingWeights="CPU=0.0,Mem=0.0G"
